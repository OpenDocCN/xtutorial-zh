# 动态类型

> 原文：<https://csharp.net-tutorials.com/data-types/the-dynamic-type/>

在 C # 4.0 版本中，微软引入了一种新的类型:动态。它实际上是一种静态类型，但与其他静态类型不同，编译器不会检查动态对象的(潜在)成员。这将为您提供动态/弱类型语言的一些优势，同时在所有其他情况下保持强类型语言的优势。

声明一个动态就像声明任何其他类型一样——简单地使用 *dynamic* 关键字代替数据类型:

```
dynamic d1;
dynamic d2 = "A string";
dynamic d3 = 42;
```

现在你有了三个不同的对象——第一个此时真的什么都没有(null ),而第二个是字符串，第三个是整数。解释器将在运行时根据你对变量的赋值自动做出决定。这也意味着编译器不会检查你对这些变量做了什么，如下例所示:

```
dynamic d1;
dynamic d2 = "A string";
dynamic d3 = 42;
Console.WriteLine(d2.Length);
Console.WriteLine(d3.Length);
```

字符串有一个长度属性，用来决定字符串的长度，但是整数没有。在这种情况下，我尝试对两个变量都使用这个属性，编译器不会抱怨它——如果这些变量被声明为一个字符串和一个整数，编译器就会拦截。但是因为类型是动态的，它只是编译和运行。然而，只要解释器到达最后一行，就会抛出一个异常，因为显然你不能访问一个不存在的属性。

<input type="hidden" name="IL_IN_ARTICLE">

这也显示了动态类型的危险——你必须意识到你在做什么，并确保你正确地拼写每个属性和方法调用，因为编译器不会仔细检查你的工作，基本上允许你发布每次都失败的代码。

## 动态对象

当然，dynamic 关键字可以用于比整数和字符串更复杂的类型。一个很好的例子是当它用来保存一个匿名对象时，就像这样:

```
dynamic user = new
{
    Name = "John Doe",
    Age = 42
};
Console.WriteLine(user.Name + " is " + user.Age + " years old");
```

这允许您创建一个对象，而无需先为它定义一个类。可以使用 *dynamic* 关键字来保存它，但是也可以使用 *var* 关键字，这可能更适合于许多情况。

您可能会认为，既然类型是动态的，您可以稍后再向它添加属性，就像这样:

```
dynamic user = new
{
    Name = "John Doe",
    Age = 42
};
user.HomeTown = "New York";
```

由于没有对动态类型进行编译时检查，所以这段代码实际上会运行，因为编译器实际上并不验证*homeland*属性的存在，但是只要到达最后一行，就会抛出异常。虽然动态类型非常动态，但它不允许您动态地向它添加新属性。为此，您可以使用 ExpandoObject，这将在下一篇文章中讨论。

## 改变类型

声明为动态的变量根本不是无类型的。相反，C#会在内部将它视为您分配给它的任何类型的对象。在我们的第一个例子中，您将看到我们如何将一个变量声明为动态变量，将一个字符串或一个整数赋给它，然后开始使用属于这些类型的属性。但是，您可以很容易地改变动态变量的类型——只需给它赋一个新值。这里有一个例子:

```
dynamic user = new
{
    Name = "John Doe",
    Age = 42
};
Console.WriteLine(user.GetType() + ": " + user.Name + " is " + user.Age + " years old");
user = "Jane Doe";
Console.WriteLine(user.GetType() + ": String.Length = " + user.Length);
```

注意我们是如何使用动态*用户*变量的:首先它保存一个匿名对象，然后我们给它分配一个简单的字符串。我们通过使用在所有 C#对象上找到的 GetType()方法来验证它，并且在这两种情况下，我们访问在我们当前拥有的类型上找到的属性(匿名对象的名字/年龄属性，然后是在字符串对象上找到的长度属性)。

## 摘要

dynamic 关键字允许您使用非特定类型的变量——相反，它们充当它们所保存的数据类型。你可以很容易地给一个动态变量赋一个新值，如果你赋的值的类型和它当前拥有的不一样，这个动态变量会自动改变类型。

编译器不检查动态变量，允许您访问可能存在也可能不存在的属性。这使它们非常灵活，但也使您的应用程序更容易出错。尤其是因为这个原因，您可能希望将动态关键字的使用限制在不使用它就无法实现您想要的东西的情况下。使用 dynamic 关键字很有意义的例子是在 COM interop 和与 JSON 和 XML 等数据格式交互时。

* * *