# 局部视图

> 原文:[https://asp.mvc-tutorial.com/views/partial-views/](https://asp.mvc-tutorial.com/views/partial-views/)

到目前为止，我们只处理了完整的视图——返回给客户机的所有内容都存在于这个视图中。然而，有许多方法可以将标记分割到几个地方，这是一件好事，原因有几个，最明显的是在多个地方重用视图标记和/或逻辑。

我们将在本教程的下一章中讨论布局，也就是你可以用一个通用模板来包装你的视图的概念，但是现在我们将讨论**局部视图**。顾名思义，局部视图允许您将视图分割成几个文件。你为什么要这么做？

最明显的原因当然是你可以把一个视图的一部分分离成一个局部视图，允许你在其他视图中重用这个特定的部分。例如，如果您的页面上有一个登录表单，您可以将它放入局部视图中，并将其插入到您希望登录表单出现在多个页面上的任何位置。一个额外的好处是，通过将原始视图分解成更小的组件，可以使它变得不那么杂乱。

现在您已经知道了什么是局部视图，让我们来谈谈如何将它添加到您的项目中，然后在您的视图中使用它。

## 添加局部视图

ASP.NET MVC 中的局部视图通常遵循这些惯例:

<input type="hidden" name="IL_IN_ARTICLE">

*   它们与使用它的视图位于同一个文件夹中，或者如果多个视图正在使用它(最常见的情况),它们应该放在视图文件夹内的“共享”文件夹中
*   它的文件名通常以下划线开头，简单地表示这不是一个常规/完整的视图

准备好之后，让我们添加局部视图。我们会将它添加到我们的*共享*文件夹中，以确保我们所有的视图都可以轻松访问它:

![](../Images/45045a633d3e340c61554d08641e6109.png "Add Partial View - Menu")

在对话框中，确保选中“创建为局部视图”:

![](../Images/38df9d026fda0aaefac8633d15b60c13.png "Add Partial View - Dialog")

Visual Studio 现在将为您创建一个新的空视图，您可以将标记和 Razor 代码放入其中，就像常规视图一样。例如，我将以下内容放入我的局部视图中:

```
<div>Hello, world!</div>
<div>Today is @DateTime.Now.ToString()</div>
```

现在让我们试着从我们的一个视图中引用它，例如，我们在本教程前面讨论常规视图时创建的视图。我们将使用 MVC 框架中的 **Html** 辅助对象的方法之一，称为 **PartialAsync()** :

```
@{
    ViewData["Title"] = "Index";
}

<h2>Index</h2>

@await Html.PartialAsync("_Greeting")

<span>More stuff here....</span>
```

此时不要担心 **await** 关键字——它与 PartialAsync()方法的异步特性有关，但这超出了本教程的范围。

当呈现视图时，局部视图的内容会自动注入到调用 PartialAsync()方法的地方，与视图的其余部分混合在一起。注意，我们不需要指定完整的文件名和局部视图的路径——在视图发现过程中会自动搜索共享文件夹。但是，如果您将局部视图放置在完全不同的位置，您可能需要指定完整的相对路径，如下所示:

```
@await Html.PartialAsync("/Views/SomeFolder/SomeSubFolder/_Greeting.cshtml")
```

## 将数据传递到局部视图

因为局部视图基本上只是一个常规视图，所以如果您需要访问局部视图中的数据，您可以使用相同的选项。您可以通过 ViewDataDictionary 实例使用强类型模型(例如，父视图中使用的相同模型)或自定义数据，或者甚至是两者的组合。因为这些机制对于常规视图和局部视图是相同的，所以我不会在这里详细讨论它，而是在我们关于将数据传递到视图的文章中更深入地探讨这个主题。

不过，我将留给您一个很酷的小例子，展示如何使用 PartialAsync 方法来完成所有这些工作。它基于一个非常常见的场景，其中部分视图包含在视图中多次呈现一个对象所需的标记。我们可以通过在循环内调用 PartialAsync()方法来实现这一点，并且我们可以使用一个 ViewDataDictionary 实例来传入当前迭代的索引:

```
@for (int i = 0; i < 3; i++)
{
    @await Html.PartialAsync("_Greeting", Model, new ViewDataDictionary(ViewData) { { "index", i } })
}
```

在局部视图中，您可以轻松访问自定义数据:

```
<span>
    Iteration number @ViewData["index"]
</span>
```

默认情况下，您可以在局部视图中自动访问与父视图中相同的视图数据，但是正如上面的示例所示，您当然可以自由地传入新数据。

## 摘要

局部视图允许您将视图分割成小的“组件”，这些组件可以在多个视图中重用，同时使原始视图不那么杂乱。

* * *